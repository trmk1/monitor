<? include ($_SERVER['DOCUMENT_ROOT'].'/1/blocks/verh.php');?>
	<!--Тело страницы начало -->



<?php

$filename = "test.txt";
$somecontent = '<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
   <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
    <head>
        <meta http-equiv="content-type" content="text/html; charset=windows-1251" />
        <meta name="author" content="zabey" />
        <title>Demo</title>
    </head>
    <body>';

   
$somecontent=$somecontent."Экспорт в эксель ВСЕХ Данных";
 
 $jazik="русский";
//$predmet="математика"; echo "<br> =========".$somecontent;







$result33 = mysql_query("SELECT * FROM predmetsp  "); // AND chetvert="$chet"  WHERE cod_pred<="$codpred"
$s=0;
// Так как запрос возвращает несколько строк, применяем цикл
while($myrow33 = mysql_fetch_array ($result33))
			{  	
			$prd=$myrow33[predmet];
			$predmet=$prd;
			
			if ($jazik==русский)  $jazik1="русским";
			if ($jazik==казахский)  $jazik1="казахским";

			// else $jazik1="казахским";
			$somecontent=$somecontent."<br><table border='1' align='center' >";
			$result = mysql_query("SELECT * FROM promejutki ");
			
			    while ($myrow = mysql_fetch_array($result))	 
					{
							
					$predmet=$predmet;
								$result = mysql_query("SELECT * FROM promejutki ");	// WHERE ( ZAVEDENIE="$user" AND	TIP="NEW") ORDER BY FAM ASC				
								 while ($myrow = mysql_fetch_array($result))	
								{
					
								//include ("mon_excel_in1.php");

								
								
								
																
								
								
								
								$pro=$myrow["pro"];

$somecontent=$somecontent."<tr> <td rowspan='8' class='vertical'> $pro </td><td> <div align='center'>класс</div></td><td><div align='center'>1</div></td><td><div align='center'>2</div></td><td><div align='center'>3</div></td><td><div align='center'>4</div></td><td><div align='center'>5</div></td><td><div align='center'>6</div></td><td><div align='center'>7</div></td><td><div align='center'>8</div></td><td><div align='center'>9</div></td><td><div align='center'>10</div></td><td><div align='center'>11</div></td></tr>";	
 			// строчка 6
			$somecontent=$somecontent."<tr>";

			$somecontent=$somecontent."<td><div align='center'>'количество учащихся'</div></td>";

			for ( $i=1; $i<=11; $i++) 
			{ 
	
			$request= mysql_query("SELECT SUM(dva) as sum FROM monitor2012 WHERE predmet='$predmet' AND chetvert='$pro' AND   jaz='$jazik' AND   klass='$i'  AND raion='$raion' and oblast='$oblast' ");    //  AND  ocenka="5"
			$row=mysql_fetch_array($request);
			$ocenk2[$pro]=$row["sum"];
			
			$request= mysql_query("SELECT SUM(tri) as sum FROM monitor2012 WHERE predmet='$predmet' AND chetvert='$pro' AND   jaz='$jazik' AND   klass='$i'  AND raion='$raion' and oblast='$oblast' ");    //  AND  ocenka="5"
			$row=mysql_fetch_array($request);
			$ocenk3[$pro]=$row["sum"];
			
			$request= mysql_query("SELECT SUM(chetir) as sum FROM monitor2012 WHERE predmet='$predmet' AND chetvert='$pro' AND   jaz='$jazik' AND   klass='$i'  AND raion='$raion' and oblast='$oblast' ");    //  AND  ocenka="5"
			$row=mysql_fetch_array($request);
			$ocenk4[$pro]=$row["sum"];

			$request= mysql_query("SELECT SUM(pater) as sum FROM monitor2012 WHERE predmet='$predmet' AND chetvert='$pro' AND   jaz='$jazik' AND   klass='$i'  AND raion='$raion' and oblast='$oblast' ");    //  AND  ocenka="5"
			$row=mysql_fetch_array($request);
			$ocenk5[$pro]=$row["sum"];
			
			$ocenk6[$pro]=($ocenk5[$pro]+ $ocenk4[$pro]+ $ocenk3[$pro]+$ocenk2[$pro]);
			
			
			
			
/* 			$request= mysql_query("SELECT SUM(kol) as sum FROM monitor2012 WHERE predmet='$predmet' AND chetvert='$pro' AND   jaz='$jazik' AND   klass='$i'  AND raion='$raion' and oblast='$oblast' ");    //  AND  ocenka="5"
			$row=mysql_fetch_array($request);
			$ocenk6[$pro]=$row["sum"]; */
			
			$somecontent=$somecontent. "<td><div align='center'>$ocenk6[$pro]</div></td>"; 
			} 
			$somecontent=$somecontent. "</tr>" ;
			
			
				// строчка 5
			$somecontent=$somecontent. "<tr>";

			$somecontent=$somecontent. "<td><div align='center'>'5'</div></td>";

			for ( $i=1; $i<=11; $i++) 
			{ 
			$request= mysql_query("SELECT SUM(pater) as sum FROM monitor2012 WHERE predmet='$predmet' AND chetvert='$pro' AND   jaz='$jazik' AND   klass='$i'  AND raion='$raion' and oblast='$oblast' ");    //  AND  ocenka='5'
			$row=mysql_fetch_array($request);
			$ocenk5[$pro]=$row["sum"];
			$somecontent=$somecontent. "<td><div align='center'>$ocenk5[$pro]</div></td>"; 
			} 
			$somecontent=$somecontent. "</tr>" ;

				// строчка 4
			$somecontent=$somecontent. "<tr> ";

			$somecontent=$somecontent. "<td><div align='center'>'4'</div></td>";

			for ( $i=1; $i<=11; $i++) 
			{ 
			$request= mysql_query("SELECT SUM(chetir) as sum FROM monitor2012 WHERE predmet='$predmet' AND chetvert='$pro' AND   jaz='$jazik' AND   klass='$i'  AND raion='$raion' and oblast='$oblast' ");    //  AND  ocenka='5'
			$row=mysql_fetch_array($request);
			$ocenk4[$pro]=$row["sum"];
			$somecontent=$somecontent. "<td><div align='center'>$ocenk4[$pro]</div></td>"; 
			} 
			$somecontent=$somecontent. "</tr>" ;


				// строчка 3
			$somecontent=$somecontent. "<tr> ";

			$somecontent=$somecontent. "<td><div align='center'>'3'</div></td>";

			for ( $i=1; $i<=11; $i++) 
			{ 
			$request= mysql_query("SELECT SUM(tri) as sum FROM monitor2012 WHERE predmet='$predmet' AND chetvert='$pro' AND   jaz='$jazik' AND   klass='$i'  AND raion='$raion' and oblast='$oblast' ");    //  AND  ocenka='5'
			$row=mysql_fetch_array($request);
			$ocenk3[$pro]=$row["sum"];
			$somecontent=$somecontent. "<td><div align='center'>$ocenk3[$pro]</div></td>"; 
			} 
			$somecontent=$somecontent. "</tr>" ;


				// строчка 2
			$somecontent=$somecontent. "<tr> ";

			$somecontent=$somecontent. "<td><div align='center'>'2'</div></td>";

			for ( $i=1; $i<=11; $i++) 
			{ 
			$request= mysql_query("SELECT SUM(dva) as sum FROM monitor2012 WHERE predmet='$predmet' AND chetvert='$pro' AND   jaz='$jazik' AND   klass='$i'  AND raion='$raion' and oblast='$oblast' ");    //  AND  ocenka='5'
			$row=mysql_fetch_array($request);
			$ocenk2[$pro]=$row["sum"];
			$somecontent=$somecontent. "<td><div align='center'>$ocenk2[$pro]</div></td>"; 
			} 
			$somecontent=$somecontent. "</tr>" ;



						
// загол 
		$somecontent=$somecontent. "<tr> ";

			$somecontent=$somecontent. "<td><div align='center'>% успеваемости</div></td>";

			for ( $i=1; $i<=11; $i++) 
			{ 
			$request= mysql_query("SELECT SUM(dva) as sum FROM monitor2012 WHERE predmet='$predmet' AND chetvert='$pro' AND   jaz='$jazik' AND   klass='$i'  AND raion='$raion' and oblast='$oblast' ");    //  AND  ocenka='5'
			$row=mysql_fetch_array($request);
			$ocenk2[$pro]=$row["sum"];
			
			$request= mysql_query("SELECT SUM(tri) as sum FROM monitor2012 WHERE predmet='$predmet' AND chetvert='$pro' AND   jaz='$jazik' AND   klass='$i'  AND raion='$raion' and oblast='$oblast' ");    //  AND  ocenka='5'
			$row=mysql_fetch_array($request);
			$ocenk3[$pro]=$row["sum"];
			
			$request= mysql_query("SELECT SUM(chetir) as sum FROM monitor2012 WHERE predmet='$predmet' AND chetvert='$pro' AND   jaz='$jazik' AND   klass='$i'  AND raion='$raion' and oblast='$oblast' ");    //  AND  ocenka='5'
			$row=mysql_fetch_array($request);
			$ocenk4[$pro]=$row["sum"];

			$request= mysql_query("SELECT SUM(pater) as sum FROM monitor2012 WHERE predmet='$predmet' AND chetvert='$pro' AND   jaz='$jazik' AND   klass='$i'  AND raion='$raion' and oblast='$oblast' ");    //  AND  ocenka='5'
			$row=mysql_fetch_array($request);
			$ocenk5[$pro]=$row["sum"];

			
			$usp[$pro]=round(($ocenk5[$pro]+ $ocenk4[$pro]+ $ocenk3[$pro])/($ocenk5[$pro]+ $ocenk4[$pro]+ $ocenk3[$pro]+$ocenk2[$pro])*100);
			
			
			
			$somecontent=$somecontent. "<td><div align='center'>$usp[$pro]</div></td>"; 
			} 
			$somecontent=$somecontent. "</tr>" ;

						
// загол 
		$somecontent=$somecontent. "<tr> ";

			$somecontent=$somecontent. "<td><div align='center'>% качества</div></td>";

			for ( $i=1; $i<=11; $i++) 
			{ 
			$request= mysql_query("SELECT SUM(dva) as sum FROM monitor2012 WHERE predmet='$predmet' AND chetvert='$pro' AND   jaz='$jazik' AND   klass='$i'  AND raion='$raion' and oblast='$oblast' ");    //  AND  ocenka='5'
			$row=mysql_fetch_array($request);
			$ocenk2[$pro]=$row["sum"];
			
			$request= mysql_query("SELECT SUM(tri) as sum FROM monitor2012 WHERE predmet='$predmet' AND chetvert='$pro' AND   jaz='$jazik' AND   klass='$i'  AND raion='$raion' and oblast='$oblast' ");    //  AND  ocenka='5'
			$row=mysql_fetch_array($request);
			$ocenk3[$pro]=$row["sum"];
			
			$request= mysql_query("SELECT SUM(chetir) as sum FROM monitor2012 WHERE predmet='$predmet' AND chetvert='$pro' AND   jaz='$jazik' AND   klass='$i'  AND raion='$raion' and oblast='$oblast' ");    //  AND  ocenka='5'
			$row=mysql_fetch_array($request);
			$ocenk4[$pro]=$row["sum"];

			$request= mysql_query("SELECT SUM(pater) as sum FROM monitor2012 WHERE predmet='$predmet' AND chetvert='$pro' AND   jaz='$jazik' AND   klass='$i'  AND raion='$raion' and oblast='$oblast' ");    //  AND  ocenka='5'
			$row=mysql_fetch_array($request);
			$ocenk5[$pro]=$row["sum"];

			
			$usp[$pro]=round(($ocenk5[$pro]+ $ocenk4[$pro])/($ocenk5[$pro]+ $ocenk4[$pro]+ $ocenk3[$pro]+$ocenk2[$pro])*100);
			
			
			
			$somecontent=$somecontent. "<td><div align='center'>$usp[$pro]</div></td>"; 
			} 
		
		$somecontent=$somecontent. "</tr>" ;
	
								
								
								
								
								
								
								
								
								
								
								
								
								
								
								
								}
										
					 $s=$s+1;
					 $somecontent=$somecontent."</tr>";
					 	 
					 
					// $today = date("d.m.y, H:i:s");
					 // $somecontent=$somecontent. "<tr> ******* Отчет сформирован   ".$today."********* </td> ";					 
					 }
					 
					$somecontent=$somecontent."<p align='center'>Сводная таблица результатов 
					текущего  успеваемости, промежуточного контроля  <br> и итоговой аттестации 
					учащихся по школам ".$raion1 ;
					$somecontent=$somecontent."<br>по предмету - ".$predmet." (в школе с ".$jazik1." языком  обучения)</p>";
					$somecontent=$somecontent.substr($predmet, 0, 15)."(".substr($jazik, 0, 3).")";
					
		$enn=strlen($somecontent);
		echo "<br> =========".$predmet." -- ".$jazik1;	
		echo "длина - ".$enn;
					 
			}




						
								echo "<br> завершенно";








 
 
 
// Вначале давайте убедимся, что файл существует и доступен для записи.
if (is_writable($filename)) {
 
    // В нашем примере мы открываем $filename в режиме "дописать в конец".
    // Таким образом, смещение установлено в конец файла и
    // наш $somecontent допишется в конец при использовании fwrite().
    if (!$handle = fopen($filename, "a")) {
         echo "Не могу открыть файл ($filename)";
         exit;
    }
 
    // Записываем $somecontent в наш открытый файл.
    if (fwrite($handle, $somecontent) === FALSE) {
        echo "Не могу произвести запись в файл ($filename)";
        exit;
    }
 
    echo "Ура! Записали ($somecontent) в файл ($filename)";
 
    fclose($handle);
 
} else {
    echo "Файл $filename недоступен для записи";
}








/* 

include_once ($_SERVER["DOCUMENT_ROOT"]."/1/blocks/lock.php");



$jazik="казахский";
// $predmet="математика";

include ("mon_excel_in.php"); 

// свод

include ("mon_excel_in_s.php"); 



echo "</table>";
echo "</body></html>";
// не забываем закрывать таблицу, боди и сам хтмл документ
 */
?>

